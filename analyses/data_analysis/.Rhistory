rolling_mean <- function(x, n) {
stats::filter(x, rep(1/n, n), sides = 1, circular = FALSE)
}
# Calculate rolling averages
data_formatted <- data_formatted %>%
group_by(ParticipantID) %>%
mutate(
average_past_4_deadlines = lag(rolling_mean(Deadline, 4), default = NA),  # Shift by 1
average_past_2_deadlines = lag(rolling_mean(Deadline, 2), default = NA),  # Shift by 1
average_past_6_deadlines = lag(rolling_mean(Deadline, 6), default = NA)   # Shift by 1
) %>%
ungroup()
library(zoo)
# Calculate rolling averages
data_formatted <- data_formatted %>%
group_by(ParticipantID) %>%
mutate(
average_past_4_deadlines = lag(rollmean(Deadline, 4), default = NA),  # Shift by 1
average_past_2_deadlines = lag(rollmean(Deadline, 2), default = NA),  # Shift by 1
average_past_6_deadlines = lag(rollmean(Deadline, 6), default = NA)   # Shift by 1
) %>%
ungroup()
# Calculate rolling averages
data_formatted <- data_formatted %>%
group_by(ParticipantID) %>%
mutate(
Deadline = as.numeric(as.character(Deadline))
average_past_4_deadlines = lag(rollmean(Deadline, 4), default = NA),  # Shift by 1
ggplot(data = data_formatted, aes(x = log_ratio_RT_TT, y = log_djr, color = Deadline)) +
geom_point(alpha = 0.7, size = 2) +  # Scatter points with some transparency and size
labs(
title = "Scatter Plot of log_ratio_RT_TT vs log_djr",
x = "log_ratio_RT_TT",
y = "log_djr",
color = "Deadline"
) +
theme_minimal() +  # Use a clean theme
theme(
legend.position = "right",  # Place legend on the right
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
# Calculate rolling averages
data_formatted <- data_formatted %>%
group_by(ParticipantID) %>%
mutate(
Deadline = as.numeric(as.character(Deadline)),
average_past_4_deadlines = lag(rollmean(Deadline, 4), default = NA),  # Shift by 1
average_past_2_deadlines = lag(rollmean(Deadline, 2), default = NA),  # Shift by 1
average_past_6_deadlines = lag(rollmean(Deadline, 6), default = NA)   # Shift by 1
) %>%
ungroup()
library(httr)
library(readr)
library(dplyr)
library(lme4)
library(lmerTest)
library(MuMIn)
library(lmtest)
library(ggplot2)
library(car)
library(tibble)
# Experiment version
exp_version <- 2
# Nextcloud credentials
username <- "algarrid"
password <- "faunistico"
file_url <- "https://cloud.ilabt.imec.be/remote.php/dav/files/af741990-37f9-103d-9441-9bec5c4808a7/ExperimentsData/risky_dm_2/ExperimentData/experiment_reprotaskmethod1quest1_answers.csv"
# Make a request to get the file content
response <- GET(file_url, authenticate(username, password))
if (status_code(response) == 200) {
# Read the CSV content directly into a data frame
csv_content <- content(response, as = "text", encoding = "UTF-8")
df_experiment <- read_csv(csv_content)
# Notify successful download
print("Experiment data downloaded")
} else {
stop(paste("Failed to retrieve the file. Status code:", status_code(response)))
}
# Fix bug for pilot number 2
if (exp_version == 2) {
df_experiment <- df_experiment %>%
mutate(GambleFinalDeadline = ifelse(
ResponseTimeGamble > 8 & GambleFinalDeadline == 8,
10,
GambleFinalDeadline
)) %>%
filter(FullScreenExited == 0)  # Remove rows where the screen was exited
}
# List of rejected participants
rejected_participants_list <- c(
"670ca14484c2bdc633b10f21", # Extremely low Reproduced Times and failed both attention checks
"622e282986d38f7f8fb74e93", # Extremely low Reproduced Times
"6691b722e54f9a743dfd308c", # Failed the comprehension check
"6658ca018e28e3383feae8e9", # Exited full screen mode more than 3 times, only did 24 minutes
"62ac71cec3309a48781684eb", # Exited full screen mode more than three times
"6658b14e39f5e53a96a6a8f4"  # Extremely low Reproduced Times
)
# Remove all rejected participants
df_experiment <- df_experiment %>%
filter(!ParticipantID %in% rejected_participants_list)
# Get unique participant IDs and count them
par_ids <- unique(df_experiment$ParticipantID)
n_par <- length(par_ids)
# Print the number of participants
print(paste("Number of participants:", n_par))
# Filter the data
df_clean_experiment <- df_experiment %>%
filter(MissedMaxDeadline == 0 & FullScreenExited == 0)
# Apply the transformations
data_formatted <- df_clean_experiment %>%
mutate(
ParticipantID = as.factor(ParticipantID),  # Convert ParticipantID to a factor (equivalent to 'category' in pandas)
Deadline = as.factor(GambleFinalDeadline),  # Convert Deadline to a factor
log_ratio_RT_TT = log(ResponseTimeGamble / GambleFinalDeadline),  # Compute log_ratio_RT_TT
log_djr = log(ReproducedTime / GambleFinalDeadline)  # Compute log_djr
Repro_time = ReproducedTime
# Apply the transformations
data_formatted <- df_clean_experiment %>%
mutate(
ParticipantID = as.factor(ParticipantID),  # Convert ParticipantID to a factor (equivalent to 'category' in pandas)
Deadline = as.factor(GambleFinalDeadline),  # Convert Deadline to a factor
log_ratio_RT_TT = log(ResponseTimeGamble / GambleFinalDeadline),  # Compute log_ratio_RT_TT
log_djr = log(ReproducedTime / GambleFinalDeadline) / # Compute log_djr
Repro_time = ReproducedTime
# Apply the transformations
data_formatted <- df_clean_experiment %>%
mutate(
ParticipantID = as.factor(ParticipantID),  # Convert ParticipantID to a factor (equivalent to 'category' in pandas)
Deadline = as.factor(GambleFinalDeadline),  # Convert Deadline to a factor
log_ratio_RT_TT = log(ResponseTimeGamble / GambleFinalDeadline),  # Compute log_ratio_RT_TT
log_djr = log(ReproducedTime / GambleFinalDeadline), # Compute log_djr
Repro_time = ReproducedTime
)
# Compute mean, SD, and CV per participant and deadline
cv_data <- df_clean_experiment %>%
mutate(ParticipantID = as.factor(ParticipantID),
Deadline = as.factor(GambleFinalDeadline)) %>%
group_by(ParticipantID, Deadline) %>%
summarise(
mean_ReproTime = mean(ReproducedTime, na.rm = TRUE),
sd_ReproTime = sd(ReproducedTime, na.rm = TRUE),
CV = sd_ReproTime / mean_ReproTime  # Compute CV
) %>%
ungroup()
# Check result
head(cv_data)
# Convert to wide format for easier list creation
cv_wide <- cv_data %>%
select(ParticipantID, Deadline, CV) %>%
pivot_wider(names_from = Deadline, values_from = CV, names_prefix = "CV_deadline_")
# Create a list of CV values per participant
cv_list <- split(cv_wide[, -1], cv_wide$ParticipantID)
# Check an example participant's CV values
cv_list[[1]]
install.packages("tidyr")
library(tidyr)
# Convert to wide format for easier list creation
cv_wide <- cv_data %>%
select(ParticipantID, Deadline, CV) %>%
pivot_wider(names_from = Deadline, values_from = CV, names_prefix = "CV_deadline_")
# Create a list of CV values per participant
cv_list <- split(cv_wide[, -1], cv_wide$ParticipantID)
# Check an example participant's CV values
cv_list[[1]]
cv_long <- cv_data %>%
select(ParticipantID, Deadline, CV)  # Keep only relevant columns
# Check structure
head(cv_long)
# Fit the model: CV ~ Deadline + (1 | ParticipantID)
lme_cv <- lmer(CV ~ Deadline + (1 | ParticipantID), data = cv_long)
# Model summary
summary(lme_cv)
cv_long <- cv_long %>%
mutate(Deadline = as.numeric(as.character(Deadline)))  # Convert factor to numeric
# Fit the model: CV ~ Deadline + (1 | ParticipantID)
lme_cv <- lmer(CV ~ Deadline + (1 | ParticipantID), data = cv_long)
# Model summary
summary(lme_cv)
r2_lme_cv <- r.squaredGLMM(lme_cv)
# Print the results
print(r2_lme_cv)
par_ids_negative_delta_par <- list(
"590df20e12802600017e1006",
"5b2bcfb51835660001cc6751",
"5bd0a57f446a8e0001204390",
"5be2fc5f0d71c80001ff4cb2",
"5e1f97bb97308b2cf7b254fb",
"6649d3063d417260fe8e3d7f",
"66cf306107ad4fcf4bef6f2f"
)
cv_long_filtered <- cv_long %>%
filter(ParticipantID %in% par_ids_negative_delta_par)
# Fit the model for the filtered participants
lme_cv_filtered <- lmer(CV ~ Deadline + (1 | ParticipantID), data = cv_long_filtered)
# Model summary
summary(lme_cv_filtered)
r2_lme_cv_filtered <- r.squaredGLMM(lme_cv_filtered)
# Print the results
print(r2_lme_cv_filtered)
#----------------Load required libraries------------------------#
install.packages("httr")
install.packages("readr")
install.packages("dplyr")
install.packages("lme4")
install.packages("lmerTest")
install.packages("MuMIn")
install.packages("lmtest")
install.packages("car")
install.packages("tibble")
install.packages("tidyr")
library(httr)
library(readr)
library(dplyr)
library(lme4)
library(lmerTest)
library(MuMIn)
library(lmtest)
library(ggplot2)
library(car)
library(tibble)
library(tidyr)
# Experiment version
exp_version <- 2
# Nextcloud credentials
username <- "algarrid"
password <- "faunistico"
file_url <- "https://cloud.ilabt.imec.be/remote.php/dav/files/af741990-37f9-103d-9441-9bec5c4808a7/ExperimentsData/risky_dm_2/ExperimentData/experiment_reprotaskmethod1quest1_answers.csv"
# Make a request to get the file content
response <- GET(file_url, authenticate(username, password))
if (status_code(response) == 200) {
# Read the CSV content directly into a data frame
csv_content <- content(response, as = "text", encoding = "UTF-8")
df_experiment <- read_csv(csv_content)
# Notify successful download
print("Experiment data downloaded")
} else {
stop(paste("Failed to retrieve the file. Status code:", status_code(response)))
}
# Fix bug for pilot number 2
if (exp_version == 2) {
df_experiment <- df_experiment %>%
mutate(GambleFinalDeadline = ifelse(
ResponseTimeGamble > 8 & GambleFinalDeadline == 8,
10,
GambleFinalDeadline
)) %>%
filter(FullScreenExited == 0)  # Remove rows where the screen was exited
}
# List of rejected participants
rejected_participants_list <- c(
"670ca14484c2bdc633b10f21", # Extremely low Reproduced Times and failed both attention checks
"622e282986d38f7f8fb74e93", # Extremely low Reproduced Times
"6691b722e54f9a743dfd308c", # Failed the comprehension check
"6658ca018e28e3383feae8e9", # Exited full screen mode more than 3 times, only did 24 minutes
"62ac71cec3309a48781684eb", # Exited full screen mode more than three times
"6658b14e39f5e53a96a6a8f4"  # Extremely low Reproduced Times
)
# Remove all rejected participants
df_experiment <- df_experiment %>%
filter(!ParticipantID %in% rejected_participants_list)
install.packages("lme4")
install.packages("dplyr")
install.packages("lmerTest")
# Get unique participant IDs and count them
par_ids <- unique(df_experiment$ParticipantID)
n_par <- length(par_ids)
# Print the number of participants
print(paste("Number of participants:", n_par))
# Filter the data
df_clean_experiment <- df_experiment %>%
filter(MissedMaxDeadline == 0 & FullScreenExited == 0)
# Apply the transformations
data_formatted <- df_clean_experiment %>%
mutate(
ParticipantID = as.factor(ParticipantID),  # Convert ParticipantID to a factor (equivalent to 'category' in pandas)
Deadline = as.factor(GambleFinalDeadline),  # Convert Deadline to a factor
log_ratio_RT_TT = ResponseTimeGamble / GambleFinalDeadline,  # Compute log_ratio_RT_TT
log_djr = ReproducedTime / GambleFinalDeadline, # Compute log_djr
Repro_time = ReproducedTime
)
ggplot(data = data_formatted, aes(x = log_ratio_RT_TT, y = log_djr, color = Deadline)) +
geom_point(alpha = 0.7, size = 2) +  # Scatter points with some transparency and size
labs(
title = "Scatter Plot of log_ratio_RT_TT vs log_djr",
x = "log_ratio_RT_TT",
y = "log_djr",
color = "Deadline"
) +
theme_minimal() +  # Use a clean theme
theme(
legend.position = "right",  # Place legend on the right
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
ggplot(data = data_formatted, aes(x = log_ratio_RT_TT, y = log_djr, color = ParticipantID)) +
geom_point(alpha = 0.7, size = 2) +  # Scatter points with some transparency and size
labs(
title = "Scatter Plot of log_ratio_RT_TT vs log_djr",
x = "log_ratio_RT_TT",
y = "log_djr",
color = "Participant ID"
) +
theme_minimal() +  # Use a clean theme
theme(
legend.position = "right",  # Place legend on the right
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
ggplot(data = data_formatted, aes(x = log_ratio_RT_TT, y = log_djr, color = Deadline)) +
geom_point(alpha = 0.7, size = 2) +  # Scatter points with some transparency and size
labs(
title = "Scatter Plot of log_ratio_RT_TT vs log_djr by Deadline",
x = "log_ratio_RT_TT",
y = "log_djr"
) +
facet_grid(Deadline ~ .) +  # Arrange facets vertically
theme_minimal() +  # Use a clean theme
theme(
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
# Get the list of unique Participant IDs
participants <- unique(data_formatted$ParticipantID)
# Create a loop to generate a plot for each participant
for (participant in participants) {
# Filter data for the current participant
participant_data <- subset(data_formatted, ParticipantID == participant)
# Generate the plot
p <- ggplot(data = participant_data, aes(x = log_ratio_RT_TT, y = log_djr)) +
geom_point(alpha = 0.7, size = 2, color = "blue") +  # Scatter points with fixed color
labs(
title = paste("Scatter Plot for Participant", participant),
x = "log_ratio_RT_TT",
y = "log_djr"
) +
theme_minimal() +  # Use a clean theme
theme(
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
# Print the plot
print(p)
# Optionally save the plot
# Uncomment the line below if you want to save each plot as a file
# ggsave(filename = paste0("Participant_", participant, "_scatter_plot.png"), plot = p)
}
participants <- unique(data_formatted$ParticipantID)
# Create a loop to generate a plot for each participant
for (participant in participants) {
# Filter data for the current participant
participant_data <- subset(data_formatted, ParticipantID == participant)
# Generate the plot
p <- ggplot(data = participant_data, aes(x = log_ratio_RT_TT, y = log_djr, color = Deadline)) +
geom_point(alpha = 0.7, size = 2) +  # Scatter points, color by Deadline
labs(
title = paste("Scatter Plot for Participant", participant),
x = "log_ratio_RT_TT",
y = "log_djr",
color = "Deadline"
) +
theme_minimal() +  # Use a clean theme
theme(
plot.title = element_text(hjust = 0.5)  # Center the plot title
)
# Print the plot
print(p)
}
#Fit baseline
m0 <- lmer(log_djr ~  1 + (1 | ParticipantID), data = data_formatted)
summary(m0)
#Fit model 1
m1 <- lmer(log_djr ~ log_ratio_RT_TT + (1 | ParticipantID), data = data_formatted)
summary(m1)
#Fit model 2
m2 <- lmer(log_djr ~ log_ratio_RT_TT + Deadline + (1 | ParticipantID), data = data_formatted)
summary(m2)
#Fit model 3
m3 <- lmer(log_djr ~ log_ratio_RT_TT + Deadline + log_ratio_RT_TT*Deadline + (1 | ParticipantID), data = data_formatted)
summary(m3)
#Fit model 4
m4 <- lmer(log_djr ~ Deadline + (1 | ParticipantID), data = data_formatted)
summary(m4)
#Fit model 5
m5 <- lmer(log_djr ~ Deadline + log_ratio_RT_TT*Deadline + (1 | ParticipantID), data = data_formatted)
summary(m5)
# Fit model 6
m6 <- lmer(log_djr ~ log_ratio_RT_TT*Deadline +  (1 | ParticipantID), data = data_formatted)
install.packages("dplyr")
install.packages("lme4")
install.packages("lmerTest")
summary(m6)
# Fit model 6
m7 <- lmer(log_djr ~ log_ratio_RT_TT + (1|Deadline/ParticipantID) +  (1 | ParticipantID), data = data_formatted)
summary(m7)
AIC(m0, m1, m2, m3, m4, m5, m6)
anova(m0, m1, m2, m3, m4, m5, m6)
anova(m2,m4)
lrtest(m2, m4)
install.packages("lme4")
install.packages("lmerTest")
##----------------Load packages-------------------------------
library(httr)
library(readr)
library(dplyr)
library(lme4)
library(performance)
library(see)
library(ordinal)
library(serp)
library(emmeans)
library(rms)
library(Hmisc)   # not rms::
setwd("C:/Users/Administrator/OneDrive - UGent/Experiments/risky_dm/data_analysis/decision_making_models/PyMC/Hierarchical/data_analysis")
# Load processed experiment data ----
processed_path <- "../data_preprocessing/processed_data/processed_risky_dm_task_data.csv"
df_processed_experiment_data <- tryCatch(
{
read_csv(processed_path)   # or read.csv(processed_path)
},
error = function(e) {
message("File not found. Please run the preprocessing pipeline first to generate 'processed_risky_dm_task_data.csv'.")
stop(e)
}
)
message("Successfully loaded processed experiment data")
username <- "algarrid"
password <- "faunistico"  # <- better: use an env var, not plain text
file_url <- paste0(
"https://cloud.ilabt.imec.be/remote.php/dav/files/",
"af741990-37f9-103d-9441-9bec5c4808a7/ExperimentsData/",
"cwir_dataset/stimuli/gambles.csv"
)
response <- GET(file_url, authenticate(username, password))
if (status_code(response) == 200) {
df_gambles <- read_csv(content(response, "text", encoding = "UTF-8"))
message("Gambles downloaded")
} else {
stop("Failed to retrieve the file. Status code: ", status_code(response))
}
# Attach dX, dP, dEV to the processed data
df <- df_processed_experiment_data %>%
left_join(
df_gambles %>% select(GambleNumber, dX, dP, dEV),
by = c("ExperimentGambleNumber" = "GambleNumber")
)
df <- df %>%
mutate(
dX_c  = dX  - mean(dX,  na.rm = TRUE),
dP_c  = dP  - mean(dP,  na.rm = TRUE),
dEV_c = dEV - mean(dEV, na.rm = TRUE),
logRT = log(ResponseTimeGamble),
RT = ResponseTimeGamble
)
# Make sure ParticipantID is a factor
df$ParticipantID <- as.factor(df$ParticipantID)
df$SubjectiveDifficulty <- ordered(df$SubjectiveDifficulty, levels = 1:5)
# Scale dX and dP
df$dX_z <- as.numeric(scale(df$dX))
df$dP_z <- as.numeric(scale(df$dP))
# Group difficulty into three levels
df <- df %>%
mutate(
SubjDiff3 = case_when(
SubjectiveDifficulty %in% c(1, 2) ~ 0L,
SubjectiveDifficulty == 3        ~ 1L,
SubjectiveDifficulty %in% c(4, 5) ~ 2L,
TRUE                             ~ NA_integer_  # safety
),
SubjDiff3 = ordered(SubjDiff3, levels = c(0, 1, 2))
)
##-----------------logRT as a function of dX, dP and interaction-----------------------
lmer1_null <- lmer(
logRT ~ (1 | ParticipantID),
data = df,
REML = TRUE
)
clm_null_m <- clmm2(
SubjDiff3 ~ 1,
random = ParticipantID,
Hess=TRUE,
data = df,
)
summary(clm_null_m)
clm_m <- clmm2(
SubjDiff3 ~ logRT,
random = ParticipantID,
data = df,
Hess = TRUE
)
summary(clm_m)
clm_raw_m <- clmm2(
SubjDiff3 ~ RT,
random = ParticipantID,
data = df,
Hess = TRUE
)
summary(clm_raw_m)
clm_n_m <- clmm2(
SubjDiff3 ~ logRT,
random = ParticipantID,
nominal = ~logRT,
data = df,
Hess = TRUE
)
summary(clm_n_m)
clm_s_m <- clmm2(
SubjDiff3 ~ logRT,
random = ParticipantID,
scale = ~logRT,
Hess=TRUE,
data = df,
)
summary(clm_s_m)
confint(clm_s_m)
confint
warnings()
